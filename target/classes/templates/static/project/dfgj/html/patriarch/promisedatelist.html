<!DOCTYPE html>
<html ng-app="list">
  <head>
    <title>家长信息-列表</title>
	
    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
    <meta http-equiv="description" content="this is my page">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <link rel="icon" type="image/x-icon" href="../../../resource/img/logo.ico">
    <link rel="stylesheet" type="text/css" href="../../../../resource/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../../../../resource/css/list.css">
    <link href="../../../../resource/css/bootstrap-datetimepicker.css" rel="stylesheet" media="screen">
    <script type="text/javascript" src="../../../../resource/js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="../../../../resource/js/angular-1.0.1.min.js"></script>
    <script type="text/javascript" src="../../../../resource/js/jquery.cookie.js"></script>
   <!-- 弹出框 -->
   
	<script type="text/javascript" src="../../../../resource/js/artDialog/skins/js/artDialog.source.js"></script>
    <script type="text/javascript" src="../../../../resource/js/artDialog/skins/js/iframeTools.source.js"></script>
	<script type="text/javascript" src="../../../../resource/js/artDialog/skins/js/artDialogZJ.js"></script>
    <script type="text/javascript" src="../../../../resource/js/getUrlParam.js"></script>
    <!-- 分页 -->
	<script type="text/javascript" src="../../../../resource/js/paging.js"></script>
	<script type="text/javascript" src="../../../../resource/js/response.js"></script>
	<script type="text/javascript" src="../../../../resource/js/jquery.prompt.js"></script>
	<link rel="stylesheet" type="text/css" href="../../../../resource/css/jquery.prompt.css">
	<!-- datetime -->
	<script type="text/javascript" src="../../../../resource/js/bootstrap-datetimepicker.js" charset="UTF-8"></script>
	<script type="text/javascript" src="../../../../resource/js/locales/bootstrap-datetimepicker.fr.js" charset="UTF-8"></script>
	<script type="text/javascript" src="../../../../resource/js/date/js/eap.util.date.js"></script>	
	<!--  -->
    <script type="text/javascript">
		var flag = true;
		var list = angular.module("list", []);
		list.controller("listController",function($scope, $http) {	
			//搜索
			$scope.onSearch=function(){
				$scope.pageList();
			}
			//翻页	
			$scope.changePage=function(){
				$scope.pageList();
			}
			
			$scope.toVisit=function(task){
				var links = task.links == null ? task._links:task.links;
				parent.setFunctionLinksHref(links);
				$http({
					url : parent.getFunctionLinksHref("visit"),
					method : 'PUT',
					dataType : "json",
					withCredentials : true,
					headers : {
						'Content-Type' : 'application/json;charset=UTF-8;'
					},
					data : ''
				}).success(function(data, status, headers, config) {
					//响应成功
					$scope.pageList();
				}).error(function(data, status, headers, config) {
					//处理响应失败
					response(status);
				});
			}
			
			$scope.pageList = function(){
				pageNo = parent.currentPage;
			    var data = {"promisedate":$("#dnexttime").val()};
				$http({
					url:parent.getMenuLinksHref("patriarchlist"),
					method:'POST',
					dataType : "json",
					withCredentials: true,
					headers: {'Content-Type': 'application/json;charset=UTF-8;',"pageNo":pageNo,"pageSize":pageSize,"orderby":"promisedate","dir":"desc"},
					data: JSON.stringify(data)
					}).success(function(data, status, headers, config){
						//响应成功
						totalCount = headers('totalCount');
						pageCount = headers('pageCount');
						$scope.tasks= data;
						paging();
						initPage();
					}).error(function(data, status, headers, config){
						//处理响应失败
						response(status);
					});
			}
			$scope.pageList();
		})
		
	</script>
	<style type="text/css">
		*{webkit-box-sizing: inherit;-moz-box-sizing: inherit;}
	</style>
  </head>
  
  <body ng-controller="listController" style="color: #000;">
  	<!-- 基本操作区 -->
  	<h5>
  		<span class="glyphicon glyphicon-search"  style="margin:0px 5px;color:#99DFF8;" ></span>
  		<input type="text" id="name" class="form-control" value="" placeholder="请输入需要查找的客户名称" style="width: 20%;display: inline;">
  		<i class="glyphicon glyphicon-remove" onclick="removeSearch()"></i>
  		&nbsp; 诺放日期：&nbsp;
        <div class="input-group date form_datetime" id="nexttime" style="width:400px;display:inline-table;position: relative;top:12px;" data-date-format="dd MM yyyy - HH:ii p" data-link-field="dtp_input2">
               <input class="form-control" id="dnexttime" size="14" type="text" value="" readonly>
			   <span class="input-group-addon"><span class="glyphicon glyphicon-th"></span></span>
        </div>
		<input type="hidden" id="dtp_input2" value="" />
  		<a class="btn btn-primary" style="margin: 0px auto;width: 80px;"  href="#" role="button" ng-click="onSearch()">快速搜索</a>
  	</h5>
  	<!-- 列表区 -->
  	<table class="table">
	  <thead>
	    <tr class="info">
	      <th>序号</th>
	      <th>姓名</th>
	      <th>性别</th>
	      <th>状态</th>
	      <th>招生来源</th>
	      <th>意向级别</th>
	      <th>学校</th>
	      <th>年级</th>
	      <th>录入人</th>
	      <th>负责人</th>
	      <th>手机号</th>
	      <th>家长类型</th>
	      <th>录入日期</th>
	      <th>上次沟通</th>
	      <th>下次跟进</th>
	      <th>诺访日期</th>
	      <th>相关操作</th>
	    </tr>
	  </thead>
	  <tbody>
	    <tr ng-repeat="task in tasks"  class='tr{{$index%2+2}}'  ng-class="{selected: $index==selectedRow}">
		    <td ng-dblclick="toInfo(task)">{{$index+1}}</td>
			<td ng-dblclick="toInfo(task)">{{task.patriarch.name}}</td>
			<td ng-dblclick="toInfo(task)">{{task.patriarch.dsex}}</td>
			<td ng-dblclick="toInfo(task)">{{task.patriarch.dstatus}}</td>
			<td ng-dblclick="toInfo(task)">{{task.patriarch.dsource}}</td>
			<td ng-dblclick="toInfo(task)">{{task.patriarch.dpurpost}}</td>
			<td ng-dblclick="toInfo(task)">{{task.patriarch.dschool_id}}</td>
			<td ng-dblclick="toInfo(task)">{{task.patriarch.dgrade}}</td>
			<td ng-dblclick="toInfo(task)">{{task.patriarch.daccount_id}}</td>
			<td ng-dblclick="toInfo(task)">{{task.patriarch.dprincipal}}</td>
			<td ng-dblclick="toInfo(task)">{{task.patriarch.mobile}}</td>
			<td ng-dblclick="toInfo(task)">{{task.patriarch.dtype}}</td>
			<td ng-dblclick="toInfo(task)">{{task.patriarch.datetime}}</td>
			<td ng-dblclick="toInfo(task)">{{task.patriarch.lasttime}}</td>
			<td ng-dblclick="toInfo(task)">{{task.patriarch.nexttime}}</td>
			<td ng-dblclick="toInfo(task)">{{task.patriarch.promisedate}}</td>
			<td>
	    		<h4 ng-click="toVisit(task)" class="glyphicon glyphicon-ok"  style="margin:0px 5px;color:#99DFF8;" title="到访"></h4>
			</td>
	    </tr>
	  </tbody>
	</table>
 	<!-- 分页区 -->
	<div class="pagepanel">
		<span class="text-info" style="position:relative;top:-10px;">共<label id="totalCount"></label>条</span>
		<ul class="pagination" style="margin: 0px 10px;padding:0px;">
		</ul>
		<span class="text-info" style="position:relative;top:-10px;">第<label id="pageNo"></label>页/共<label id="pageCount"></label>页</span>
		<select id="pageSize" class="form-control" style="width: 70px;float: right;">
		</select>
		<span class="text-info" style="position:relative;top:6px;float: right;margin: 0px 5px;">每页显示</span>
	</div>
  </body>
  <script type="text/javascript">
	$('#nexttime').datetimepicker({
		format : 'yyyy-mm-dd',
		language : 'cn',
		weekStart : 1,
		minView : "month",
		todayBtn : 1,
		initialDate:new Date(),
		autoclose : 1,
		todayHighlight : 1,
		startView : 2,
		forceParse : 0,
		showMeridian : 0
	});
	$("#dnexttime").val((new Date()).formatDate("yyyy-MM-dd"));
	</script>
</html>
